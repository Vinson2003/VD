@using VD.Helper;
@{
    ViewData["Title"] = "Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="d-flex flex-column flex-column-fluid">
	<!--begin::Toolbar-->
	<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
		<!--begin::Toolbar container-->
		<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
			<!--begin::Page title-->
			<div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
				<!--begin::Title-->
				<h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Tables</h1>
				<!--end::Title-->
				<!--begin::Breadcrumb-->
				<ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
					<!--begin::Item-->
					<li class="breadcrumb-item text-muted">
						<a href="../../demo1/dist/index.html" class="text-muted text-hover-primary">Admin</a>
					</li>
					<!--end::Item-->
				</ul>
				<!--end::Breadcrumb-->
			</div>
			<!--end::Page title-->
		</div>
		<!--end::Toolbar container-->
	</div>
	<!--end::Toolbar-->
	<!--begin::Content-->
	<div id="kt_app_content" class="app-content flex-column-fluid">
		<!--begin::Content container-->
		<div id="kt_app_content_container" class="app-container container-fluid">
            <div class="card mb-5 mb-xl-8">
                <!--begin::Header-->
                <div class="card-header border-0 pt-5">
                    <div class="card-toolbar" data-bs-placement="top" data-bs-trigger="hover" data-kt-initialized="1">
                        <a href="#" class="btn btn-sm btn-light btn-active-primary" data-bs-toggle="modal" data-bs-target="#AdminAddModal">
                            <i class="ki-duotone ki-plus fs-2"></i>Add
                        </a>
                    </div>
                </div>
                <!--end::Header-->
                <!--begin::Body-->
                <div class="card-body py-3">
                    <!--begin::Table container-->
                    <div class="table-responsive">
                        <!--begin::Table-->
                        <table id="AdminList" class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
                            <!--begin::Table head-->
                            <thead>
                                <tr class="fw-bold text-muted">
                                    <th class="min-w-200px">Username</th>
                                    <th class="min-w-150px">Email</th>
                                    <th class="min-w-150px">Status</th>
                                    <th class="min-w-150px">Role</th>
                                    <th class="min-w-100px">Actions</th>
                                </tr>
                            </thead>
                            <!--end::Table head-->
                        </table>
                        <!--end::Table-->
                    </div>
                    <!--end::Table container-->
                </div>
                <!--begin::Body-->
            </div>
		</div>
		<!--end::Content container-->
	</div>
	<!--end::Content-->
</div>

@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-add"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/AddModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-update"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/EditModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-changepassword"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/ChangePasswordModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-setpassword"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/UpdateAccModal.cshtml")
}

@section Scripts {
    @await Html.PartialAsync("~/Views/Admin/JS/ModalAddJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalChangePasswordJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalEditJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalUpdateAccJS.cshtml")
    <script>
        var AdminTab
        $(document).ready(function () {
            reloadTable();
        });

        function reloadTable(){
            if(!AdminTab){
                AdminTab = $('#AdminList').DataTable({
                    "scrollX": true,
                    "processing": true,
                    "filter": false,
                    "stateSave": true,
                    "responsive": true,
                    "searching": false,
                    "serverSide": true,
                    "dom": 'Bfrtip',
                    "ajax": {
                        "url": "@Url.Action("Admin_Read", "Admin")",
                        "type": "post",
                    },
                    "columns": [
                        { "data": "username" },
                        { "data": "email" },
                        { "data": "status" },
                        { "data": "role" },
                        {
                            "data": "id",
                            "render": function (d, t, f, m) {
                                var btn = '';
                                btn += "<button class='btn btn-icon btn-bg-light btn-active-color-warning btn-sm me-1' onclick='editdata(" + m.row + ")'><i class='ki-outline ki-pencil fs-2'></i></btn>";
                                btn += "<button class='btn btn-icon btn-bg-light btn-active-color-info btn-sm me-1' onclick='changepassword(" + m.row + ")'><i class='ki-outline ki-lock fs-2'></i></btn>";
                                btn += "<button class='btn btn-icon btn-bg-light btn-active-color-success btn-sm' onclick='updateaccount(" + m.row + ")'><i class='ki-outline ki-user fs-2'></i></btn>";
                                return btn;
                            }
                        },
                    ],
                });
            } else {
                AdminTab.ajax.url("@Url.Action("Admin_Read", "Admin")").load();
            }
        }
    </script>

}