@using VD.Helper;
@{
    ViewData["Title"] = "Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card mb-5 mb-xl-8">
	<!--begin::Header-->
	<div class="card-header border-0 pt-5">
		<h3 class="card-title align-items-start flex-column">
			<span class="card-label fw-bold fs-3 mb-1">Datatables</span>
			<span class="text-muted mt-1 fw-semibold fs-7">For Admin</span>
		</h3>
		<div class="card-toolbar">
			<button type="button" class="btn btn-sm btn-light-primary" data-bs-toggle="modal" data-bs-target="#AdminAddModal">
				<i class="ki-duotone ki-plus fs-2"></i>Add
			</button>
		</div>
	</div>
	<!--end::Header-->
	<!--begin::Body-->
	<div class="card-body py-3">
		<!--begin::Table container-->
		<div class="table-responsive">
			<!--begin::Table-->
            <table id="AdminList" class="table align-middle gs-0 gy-4">
				<!--begin::Table head-->
				<thead>
					<tr class="fw-bold text-muted bg-light">
						<th class="ps-4 min-w-125px rounded-start">Username</th>
						<th class="min-w-125px">Email</th>
						<th class="min-w-125px">Status</th>
                        <th class="min-w-125px">Role</th>
                        <th class="min-w-125px">Update</th>
                        <th class="min-w-125px">Change Password</th>
						<th class="min-w-125px">Update Account</th>
					</tr>
				</thead>
                <tfoot>
                    <tr class="fw-bold text-muted bg-light">
                        <th class="ps-4 min-w-325px rounded-start">Username</th>
                        <th class="min-w-125px">Email</th>
                        <th class="min-w-125px">Status</th>
                        <th class="min-w-200px">Role</th>
                        <th class="min-w-150px">Update</th>
                        <th class="min-w-150px">Change Password</th>
                        <th class="min-w-150px">Update Account</th>
                    </tr>
                </tfoot>
				<!--end::Table head-->
			</table>
			<!--end::Table-->
		</div>
		<!--end::Table container-->
	</div>
	<!--begin::Body-->
</div>

@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-add"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/AddModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-update"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/EditModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-changepassword"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/ChangePasswordModal.cshtml")
}
@if (CheckPerms.checkpermis(User.GetRole(), ViewBag.Perms, "admin-setpassword"))
{
    @await Html.PartialAsync("~/Views/Admin/Modal/UpdateAccModal.cshtml")
}

@section Scripts {
    @await Html.PartialAsync("~/Views/Admin/JS/ModalAddJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalChangePasswordJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalEditJS.cshtml")
    @await Html.PartialAsync("~/Views/Admin/JS/ModalUpdateAccJS.cshtml")
    <script>
        var AdminTab
        $(document).ready(function () {
            reloadTable();
        });

        function reloadTable(){
            if(!AdminTab){
                AdminTab = $('#AdminList').DataTable({
                    "scrollX": true,
                    "processing": true,
                    "filter": false,
                    "stateSave": true,
                    "responsive": true,
                    "searching": false,
                    "serverSide": true,
                    "bDestroy": true,
                    "dom": 'Bfrtip',
                    "ajax": {
                        "url": "@Url.Action("Admin_Read", "Admin")",
                        "type": "POST",
                        'datatype': 'json',
                    },
                    "columns": [
                        { "data": "username" },
                        { "data": "email" },
                        { "data": "status" },
                        { "data": "role" },
                        {
                            "data": "id",
                            "render": function (d, t, f, m) {
                                return "<div><a type='button' class='btn btn-warning btn-sm' onclick='editdata(" + m.row + ")'><i class='fas fa-pen-fancy'></i></a></div>";
                            }
                        },
                        {
                            "data": "id",
                            "render": function (d, t, f, m) {
                                return "<div><a type='button' class='btn btn-info btn-sm' onclick='changepassword(" + m.row + ")'><i class='fa-solid fa-lock'></i></a></div>";
                            }
                        },
                        {
                            "data": "id",
                            "render": function (d, t, f, m) {
                                return "<div><a type='button' class='btn btn-success btn-sm' onclick='updateaccount(" + m.row + ")'><i class='fa-solid fa-user'></i></a></div>";
                            }
                        },
                    ],
                });
            } else {
                AdminTab.ajax.url("@Url.Action("Admin_Read", "Admin")").load();
            }
        }
    </script>

    <script>
        
    </script>
}